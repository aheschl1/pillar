#cloud-config
manage_etc_hosts: true
ssh_pwauth: true

users:
  - name: root
    groups: sudo
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_authorized_keys:
      - <ssh_pub_key>
    ssh_keys:
      rsa_private: |
        <ssh_priv_key>
      rsa_public: <ssh_pub_key>
      
chpasswd:
  list: |
    root:toor
  expire: False
  
package_update: true
packages:
  - sudo
  - curl
  - vim
  - git
  - openssh-server

write_files:
  - path: /root/.ssh/id_rsa
    permissions: '0600'
    owner: root:root
    content: |
      <ssh_priv_key>
    defer: true

runcmd:
  - chmod 700 /root/.ssh
  - curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  - echo 'export PATH=$HOME/.cargo/bin:$PATH' >> /root/.bashrc
  - git clone <repo_url> /root/<repo_name>
  - cd /root/<repo_name>
  - git checkout <branch_name>
  - cargo build --release
  - echo 'export PATH=$HOME/<repo_name>/target/release:$PATH' >> /root/.bashrc
  - echo 'Cloud-init complete, Rust installed' > /root/cloud-init-done